{"version":3,"sources":["..\\..\\..\\electron\\main\\window\\base.ts"],"sourcesContent":["import {BrowserWindow, WebContents, Rectangle} from \"electron\";\r\nimport {ElectronWindowOptions} from \"./options\";\r\n\r\nabstract class BaseWindow {\r\n  public nativeWindow: BrowserWindow\r\n  public webContent: WebContents\r\n  public abstract webContentUrl: string\r\n  public isWebContentLoad: boolean\r\n\r\n  public pendingList: Array<{key: string, value: any}> = []\r\n\r\n  public get isDestroyed() { return !this.nativeWindow || this.nativeWindow.isDestroyed() }\r\n\r\n  protected createNativeWindow(options: ElectronWindowOptions) {\r\n    this.onBeforeCreate()\r\n    this.nativeWindow = new BrowserWindow(options)\r\n    this.webContent = this.nativeWindow.webContents\r\n\r\n    if (!this.webContentUrl) {\r\n      throw new Error('You must provide WebContentUrl before created!')\r\n    }\r\n\r\n    this.nativeWindow\r\n      .loadURL(this.webContentUrl)\r\n      .then(() => this.isWebContentLoad = true)\r\n      .then(() => this.onCreated())\r\n      .then(() => {\r\n        this.pendingList.forEach(pending => {\r\n          this.sendToRenderer(pending.key, pending.value)\r\n        })\r\n        this.pendingList = []\r\n      })\r\n      .catch((error) => console.warn('load url error: ', error))\r\n\r\n    this.nativeWindow.once('ready-to-show', this.onBeforeShow.bind(this))\r\n    this.nativeWindow.on('show', this.onShow.bind(this))\r\n    this.nativeWindow.on('hide', this.onHidden.bind(this))\r\n    this.nativeWindow.on('close', this.onBeforeClose.bind(this))\r\n    this.nativeWindow.once('closed', this.onClosed.bind(this))\r\n  }\r\n  // 生命周期\r\n  public abstract onBeforeCreate();\r\n  public abstract onCreated();\r\n  public abstract onBeforeShow();\r\n  public abstract onShow();\r\n  public abstract onHidden();\r\n  public abstract onBeforeClose(event: Event);\r\n  public abstract onClosed();\r\n  // 一些基础操作\r\n  public show() {\r\n    if (this.isDestroyed) return\r\n\r\n    this.nativeWindow.show()\r\n  }\r\n  public hide() {\r\n    if (this.isDestroyed) return\r\n\r\n    this.nativeWindow.hide()\r\n  }\r\n  public close() {\r\n    return !this.isDestroyed && this.nativeWindow.close()\r\n  }\r\n  public forceClose() {\r\n    return !this.isDestroyed && this.nativeWindow.destroy()\r\n  }\r\n  public reload() {\r\n    return !this.isDestroyed && this.nativeWindow.reload()\r\n  }\r\n  public destroy() {\r\n    if (this.isDestroyed) return\r\n\r\n    this.nativeWindow.destroy()\r\n    this.nativeWindow = null\r\n  }\r\n  public maximize() {\r\n    if (this.isDestroyed) return\r\n\r\n    this.nativeWindow.maximize()\r\n  }\r\n  public minimize() {\r\n    if (this.isDestroyed) return\r\n\r\n    this.nativeWindow.minimize()\r\n  }\r\n\r\n  public unmaximize() {\r\n    if (this.isDestroyed) return\r\n\r\n    this.nativeWindow.unmaximize()\r\n  }\r\n  public centralize() {\r\n    if (this.isDestroyed) return\r\n\r\n    this.nativeWindow.center()\r\n  }\r\n\r\n  public setBounds(rect: Rectangle) {\r\n    if (this.isDestroyed) return\r\n\r\n    this.nativeWindow.setBounds(rect)\r\n  }\r\n\r\n  /**\r\n   * 向渲染进程发送数据（考虑渲染检测未加载情况）\r\n   * @param channel\r\n   * @param params\r\n   */\r\n  public sendToRenderer(channel: string, params?: any) {\r\n    if (!this.nativeWindow) return\r\n    if (!this.isWebContentLoad) { // 页面未加载成功，则放入pending列表\r\n      this.pendingList.push({key: channel, value: params})\r\n\r\n      return\r\n    }\r\n\r\n    this.webContent.send(channel, params)\r\n  }\r\n}\r\n\r\nexport default BaseWindow"],"mappings":";;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAAoD;AAGpD,MAAe,WAAW;AAAA,EAA1B;AAME,SAAO,cAAgD,CAAC;AAAA;AAAA,EAExD,IAAW,cAAc;AAAE,WAAO,CAAC,KAAK,gBAAgB,KAAK,aAAa,YAAY;AAAA,EAAE;AAAA,EAE9E,mBAAmB,SAAgC;AAC3D,SAAK,eAAe;AACpB,SAAK,eAAe,IAAI,8BAAc,OAAO;AAC7C,SAAK,aAAa,KAAK,aAAa;AAEpC,QAAI,CAAC,KAAK,eAAe;AACvB,YAAM,IAAI,MAAM,gDAAgD;AAAA,IAClE;AAEA,SAAK,aACF,QAAQ,KAAK,aAAa,EAC1B,KAAK,MAAM,KAAK,mBAAmB,IAAI,EACvC,KAAK,MAAM,KAAK,UAAU,CAAC,EAC3B,KAAK,MAAM;AACV,WAAK,YAAY,QAAQ,aAAW;AAClC,aAAK,eAAe,QAAQ,KAAK,QAAQ,KAAK;AAAA,MAChD,CAAC;AACD,WAAK,cAAc,CAAC;AAAA,IACtB,CAAC,EACA,MAAM,CAAC,UAAU,QAAQ,KAAK,oBAAoB,KAAK,CAAC;AAE3D,SAAK,aAAa,KAAK,iBAAiB,KAAK,aAAa,KAAK,IAAI,CAAC;AACpE,SAAK,aAAa,GAAG,QAAQ,KAAK,OAAO,KAAK,IAAI,CAAC;AACnD,SAAK,aAAa,GAAG,QAAQ,KAAK,SAAS,KAAK,IAAI,CAAC;AACrD,SAAK,aAAa,GAAG,SAAS,KAAK,cAAc,KAAK,IAAI,CAAC;AAC3D,SAAK,aAAa,KAAK,UAAU,KAAK,SAAS,KAAK,IAAI,CAAC;AAAA,EAC3D;AAAA,EAUO,OAAO;AACZ,QAAI,KAAK;AAAa;AAEtB,SAAK,aAAa,KAAK;AAAA,EACzB;AAAA,EACO,OAAO;AACZ,QAAI,KAAK;AAAa;AAEtB,SAAK,aAAa,KAAK;AAAA,EACzB;AAAA,EACO,QAAQ;AACb,WAAO,CAAC,KAAK,eAAe,KAAK,aAAa,MAAM;AAAA,EACtD;AAAA,EACO,aAAa;AAClB,WAAO,CAAC,KAAK,eAAe,KAAK,aAAa,QAAQ;AAAA,EACxD;AAAA,EACO,SAAS;AACd,WAAO,CAAC,KAAK,eAAe,KAAK,aAAa,OAAO;AAAA,EACvD;AAAA,EACO,UAAU;AACf,QAAI,KAAK;AAAa;AAEtB,SAAK,aAAa,QAAQ;AAC1B,SAAK,eAAe;AAAA,EACtB;AAAA,EACO,WAAW;AAChB,QAAI,KAAK;AAAa;AAEtB,SAAK,aAAa,SAAS;AAAA,EAC7B;AAAA,EACO,WAAW;AAChB,QAAI,KAAK;AAAa;AAEtB,SAAK,aAAa,SAAS;AAAA,EAC7B;AAAA,EAEO,aAAa;AAClB,QAAI,KAAK;AAAa;AAEtB,SAAK,aAAa,WAAW;AAAA,EAC/B;AAAA,EACO,aAAa;AAClB,QAAI,KAAK;AAAa;AAEtB,SAAK,aAAa,OAAO;AAAA,EAC3B;AAAA,EAEO,UAAU,MAAiB;AAChC,QAAI,KAAK;AAAa;AAEtB,SAAK,aAAa,UAAU,IAAI;AAAA,EAClC;AAAA,EAOO,eAAe,SAAiB,QAAc;AACnD,QAAI,CAAC,KAAK;AAAc;AACxB,QAAI,CAAC,KAAK,kBAAkB;AAC1B,WAAK,YAAY,KAAK,EAAC,KAAK,SAAS,OAAO,OAAM,CAAC;AAEnD;AAAA,IACF;AAEA,SAAK,WAAW,KAAK,SAAS,MAAM;AAAA,EACtC;AACF;AAEA,IAAO,gBAAQ;","names":[],"file":"base.js"}